C51 COMPILER V9.60.7.0   MAIN                                                              11/30/2025 20:25:54 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "TB6612FNC.h"
   3          #include "Button.h"
   4          #include "Car.h"
   5          #include "PID.h"
   6          #include "Timer.h"
   7          
   8          #define BASE_SPEED_LEVEL  0      //速度价值
   9          #define BASE_SPEED        128    //基础速度
  10          #define SCALING_FACTOR    1000   //倍率
  11          #define SCALING_FACTOR_f  1000.0 //倍率
  12          
  13          //PWM串口
  14          sbit PWMA = P0 ^ 2;
  15          sbit PWMB = P0 ^ 7;
  16          //电机串口
  17          sbit MotorL1 = P0 ^ 3;
  18          sbit MotorL2 = P0 ^ 4;
  19          sbit MotorR1 = P0 ^ 5;
  20          sbit MotorR2 = P0 ^ 6;
  21          
  22          unsigned char counter = 0;
  23          unsigned char standardL = 0;
  24          unsigned char standardR = 0;
  25          float CarValue = 0.0;
  26          int CarValue_Int = 0.0;
  27          int speedL_Int = 0;
  28          int speedR_Int = 0;
  29          float speedL = 0.0;
  30          float speedR = 0.0;
  31          
  32          //电机驱动
  33          void Motor_MoveGo(void)
  34          {
  35   1              MotorL1 = 1;MotorL2 = 0;
  36   1              MotorR1 = 1;MotorR2 = 0;
  37   1      }
  38          //电机制动
  39          void Motor_MoveStop(void)
  40          {
  41   1              MotorL1 = 1;MotorL2 = 1;
  42   1              MotorR1 = 1;MotorR2 = 1;
  43   1      }
  44          
  45          //主函数
  46          int main(void)
  47          {
  48   1              Timer_Init();
  49   1              standardL = 128;
  50   1              standardR = 128;
  51   1              while (1)
  52   1              {
  53   2                      if(Sensor_Move() != 10){Motor_MoveGo();}
  54   2                      if(Sensor_Move() == 10){Motor_MoveStop();}
C51 COMPILER V9.60.7.0   MAIN                                                              11/30/2025 20:25:54 PAGE 2   

  55   2                      standardL = BASE_SPEED + speedL * BASE_SPEED;
  56   2                      standardR = BASE_SPEED + speedR * BASE_SPEED;
  57   2              }
  58   1      }
  59          
  60          //中断函数
  61          void Timer0_Rountine(void) interrupt 1 //用来计算左右PWM
  62          {       
  63   1              //per 10us counter add 1
  64   1              TL0 = 0xF7;
  65   1              TH0 = 0xFF;
  66   1              
  67   1              if(counter > standardL){PWMA = 0; P2_0 = 0;}else{PWMA = 1; P2_0 = 1;}
  68   1              if(counter > standardR){PWMB = 0; P2_0 = 0;}else{PWMB = 1; P2_0 = 1;}
  69   1              counter++;
  70   1              
  71   1              TF0 = 0;
  72   1      }
  73          
  74          void Timer1_Rountine(void) interrupt 3
  75          {
  76   1              //per 100us counter add 1
  77   1              TL1 = 0xA4;
  78   1              TH1 = 0xFF;
  79   1              if(Sensor_Move() != 10)
  80   1              {
  81   2              CarValue = PID_Calculate(Sensor_Move());
  82   2              CarValue_Int = CarValue * SCALING_FACTOR;
  83   2              speedL_Int = BASE_SPEED_LEVEL - CarValue_Int;
  84   2              speedR_Int = BASE_SPEED_LEVEL + CarValue_Int;
  85   2              speedL = speedL_Int / SCALING_FACTOR_f;
  86   2              speedR = speedR_Int / SCALING_FACTOR_f;
  87   2              }
  88   1              TF1 = 0;
  89   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    355    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     21    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
